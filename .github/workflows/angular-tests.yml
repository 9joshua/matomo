name: Angular Tests

on:
  pull_request:

permissions:
  actions: read
  checks: none
  contents: read
  deployments: none
  issues: read
  packages: none
  pull-requests: read
  repository-projects: none
  security-events: none
  statuses: none
concurrency:
  group: angular-${{ github.head_ref }}
  cancel-in-progress: true

jobs:
  Javascript:
    runs-on: ubuntu-20.04
    strategy:
      fail-fast: false
      matrix:
        tests: [ 'AngularJSTests' ]
        node: [ '16' ]

    steps:
      - name: Checkout code
        uses: actions/checkout@v2
        with:
          lfs: false
          submodules: recursive

      - name: Setup Node
        uses: actions/setup-node@v2
        with:
          node-version: ${{ matrix.node }}

      - name: installing node/puppeteer
        working-directory: ./tests/lib/screenshot-testing
        run: npm install

      - name: Install dependencies
        run: |
          composer clear-cache
          composer install --ignore-platform-reqs

      - name: prepare setup
        shell: bash
        run: ./.github/scripts/bash/prepare.sh
        env:
          MATOMO_TEST_TARGET: 'JS'
          MYSQL_ADAPTER: 'PDO_MYSQL'

      - name: Running angularjs && vue tests
        if: matrix.tests == 'AngularJSTests'
        working-directory: ./tests/angularjs
        run: |
          npm install
          ./node_modules/karma/bin/karma start karma.conf.js --browsers ChromeHeadless --single-run
