<div #rootdiv
     [focusAnywhereButHere]
     (onLoseFocus)="showSitesList=false"
     class="siteSelector piwikSelector borderedControl"
     [attr.class]="{expanded: showSitesList, disabled: (_hasOnlyOneSite$ | async)}">

    <input *ngIf="name" type="hidden" [attr.name]="name" [value]="selectedSite.id"/>

    <a
        #selectedSiteDisplay
        (click)="onClickSelector()"
        (keyup.enter)="onClickSelector()"
        href="javascript:void(0)"
        [attr.title]="(_hasMultipleWebsites$ | async) ? ('CoreHome_ChangeCurrentWebsite'|translate) : ''"
        [attr.class]="{loading:isLoading,title:true}"
        tabindex="4"
    >
        <span [attr.class]="{icon:true,'icon-arrow-bottom':true,iconHidden:isLoading,collapsed:!showSitesList}"></span>
        <span>
            <span *ngIf="selectedSite.name || !placeholder">{{ selectedSite.name || (_firstSiteName$|async) }}</span>
            <span *ngIf="!selectedSite.name && placeholder">{{ placeholder }}</span>
        </span>
    </a>

    <div *ngIf="showSitesList" class="dropdown">
        <div class="custom_select_search" *ngIf="(autocompleteMinSites$|async) <= (_sitesLength$|async) || searchTerm">
            <input
                #customSelectInput
                type="text"
                (click)="searchTerm=''"
                [(ngModel)]="searchTerm"
                (change)="searchSite()"
                [attr.placeholder]="'General_Search'|translate"
                tabindex="4"
                class="websiteSearch inp browser-default"
            />
            <!-- TODO: translate Clear? -->
            <img title="Clear"
                 *ngIf="searchTerm"
                 (click)="clearSearchTerm()"
                 class="reset"
                 src="plugins/CoreHome/images/reset_search.png"
             />
        </div>

        <div
            *ngIf="allSitesLocation=='top' && showAllSitesItem"
        >
            <site-selector-all-sites-link
                [allSitesText]="allSitesText"
                (onClickLink)="onClickAllSitesLink($event)"
            >
            </site-selector-all-sites-link>
        </div>

        <div class="custom_select_container">
            <ul class="custom_select_ul_list" (click)="showSitesList=false">
                <!-- !showSelectedSite && activeSiteId==site.idsite -->
                <li
                    *ngFor="let site in (_sites$|async)"
                    (click)="switchSite(site, $event)"
                    [hidden]="!showSelectedSite && activeSiteId == site.idsite"
                >
                    <a
                        #listLink
                        (click)="$event.preventDefault()"
                        [attr.href]="getUrlForSiteId(site.idsite)"
                        [attr.title]="site.name"
                        [innerHTML]="site.name"
                        tabindex="4"
                    >
                    </a>
                </li>
            </ul>

            <ul
                *ngIf="!(_sitesLength$ | async) && searchTerm"
                class="ui-autocomplete ui-front ui-menu ui-widget ui-widget-content ui-corner-all siteSelect"
            >
                <li class="ui-menu-item">
                    <a class="ui-corner-all" tabindex="-1">{{ ('SitesManager_NotFound'|translate) + ' ' + searchTerm }}</a>
                </li>
            </ul>
        </div>

        <div
            *ngIf="allSitesLocation=='bottom' && showAllSitesItem"
        >
            <site-selector-all-sites-link
                [allSitesText]="allSitesText"
                (onClickLink)="onClickAllSitesLink($event)"
            >
            </site-selector-all-sites-link>
        </div>
    </div>
</div>
